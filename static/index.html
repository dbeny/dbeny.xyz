<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Marci Hajonéz Freak-wiki</title>
		<meta name="theme-color" content="#309ffa">
		<meta name="description"
			content="Mert itt a vég tudománya (tényleg) amit még törött szemhéjjal se nyunyálsz. Végső nyugovóra tér a hasznos orrú nyugágy, amickor a lenyélő bandó remeg. A itt találod a forgókeverék hasznosságának funkcióját és. Veszíthetetlen pitélytárház és kollektív kacagó.">
		<meta name="image" content="https://github.com/dbeny/dbeny.xyz/blob/main/torjonel.png">
		<meta property="og:image" content="https://github.com/dbeny/dbeny.xyz/blob/main/torjonel.png">
		<link rel="stylesheet" href="/styles/index.css">
		<link rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=open_in_new" />
		<link rel="shortcut icon"
			href="https://cdn.discordapp.com/attachments/899955220468097065/1374635704922935356/picy.png?ex=682ec4c3&is=682d7343&hm=e91fe9a6ff250a3bbb8021f94c715a37138e4d12b72e6ae5b9b861758eb8c6f6&"
			type="image/png">
		<link rel="icon"
			href="https://cdn.discordapp.com/attachments/899955220468097065/1374635704922935356/picy.png?ex=682ec4c3&is=682d7343&hm=e91fe9a6ff250a3bbb8021f94c715a37138e4d12b72e6ae5b9b861758eb8c6f6&"
			type="image/png">
	</head>
	<body>
		<div class="main-container">
			<div class="main">
				<h1>í komikus balsors kalkulátor</h1>
				<div class="kardos-container">
					<span>Új év új kormány új kardos régi espero</span>
					<h4 id="time">
						<div id="d">00</div>:<div id="h">00</div>:<div id="m">00</div>:<div id="s">00</div>
					</h4>
					<span class="smalltxt">amugy ez csak az ujevet mutatja</span>
					<span>Aktuális választások:</span>
					<h4>
						<span id="dd">00</span>:<span id="hh">00</span>:<span id="mm">00</span>:<span
							id="ss">00</span><br />
					</h4>
					<br>
					<span>Genezis dátum: <h4 id="created-at"></h4></span>
					<span>Ultima edício: <h4 id="edited-at"></h4></span>
					<br>
					<span>Megjelenő megőig megtétel:</span>
					<h4>
						<span id="ddd">00</span>:<span id="hhh">00</span>:<span id="mmm">00</span>:<span
							id="sss">00</span><br />
					</h4>
					<span class="smalltxt" id="symmetric"></span>
					<br>
					<span>Ily időben regisztráltam mestermcre: <h4 id="mestermc"></h4></span>
					<span>Unix időbélyeg: <h4 id="unix"></h4></span>
					<span>Fém: <h4 id="metallica"></h4></span>
					<br>
					<span>Kardos ennyi ideje :HOMÁR: <h4 id="kardos"></h4></span>
				</div>
			</div>
			<div class="ragebait">
				<h1>the silence is the ragebait itself</h1>
				<ul>
					Boatman? - I'll be there!<br>
					Brickman? - I'll be there!<br>
					Little German? - I'll be there!<br>
					Slinky? - I'll be there!<br>
					Judge? - I'll be there!<br>
					Snowy? - I'll be there!<br>
					Trick? - I'll be there!<br>
					Hillman? - I'll be there!<br>
					Ankle? - I'll be there!<br>
				</ul>
				<span>Csimpákoló nyitralók és boka aki fekete fekete bokája → ₯ (srác tökély)<br>Praktikus világklasszis
					bottle (üveg)</span><br>
				<div class="mogging">
					<img src="/imgs/mog.gif" alt=""><br>
					you rn
				</div>
				túl sok a kacaj (hahota)
			</div>
			<div class="side-container">
				<div class="side">
					<h1>In the case of stupidity</h1>
					<div class="red">
						<h5>Maybe you wanted to go the 2nd best ragebait site:</h5>
						<a href="https://fv.dbeny.xyz" target="_blank">Formula V Website <span
								class="material-symbols-outlined">open_in_new</span></a>
					</div>
				</div>
				<div class="describe">
					<div class="red">
						<h1>Ezek vagytok mi</h1>
						<h3>a grund homályában</h3>
					</div>
					<p>Mert itt a vég tudománya (tényleg) amit még törött szemhéjjal se nyunyálsz. Végső nyugovóra tér a
						hasznos orrú nyugágy, amickor a lenyélő bandó remeg. A itt találod a forgókeverék hasznosságának
						funkcióját és. Veszíthetetlen pitélytárház és kollektív kacagó.</p>
				</div>
			</div>
		</div>
		<div class="dts">
			<div class="ctx">
				<h1>Dani és Beni padja type shit</h1>
				<h3>Context: nem kapsz (ott van a cnc mogott)</h3>
			</div>
			<ul></ul>
			<div class="footer">
				<span>:BandiOfUndying: Made by Ben and Soviaat :catWow:</span>
			</div>
		</div>
		<footer>
			<div class="random">
				láb
				ol(l)ó
				fészek
			</div>
			<div class="links"><a class="dash" href="/auth/discord">Dashboard</a></div>
		</footer>
		<script src="/script.js"></script>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
			const floatingFooter = document.querySelector(".dts .footer");
			const realFooter = document.querySelector("footer.the.real.foot.her");

			const observer = new IntersectionObserver(entries => {
				entries.forEach(entry => {
				if (entry.isIntersecting) {
					// When real footer comes into view → stop floating
					floatingFooter.style.position = "absolute";
					floatingFooter.style.bottom = realFooter.offsetHeight + "px";
				} else {
					// Otherwise keep it fixed at bottom
					floatingFooter.style.position = "fixed";
					floatingFooter.style.bottom = "0";
					floatingFooter.style.left = "0";
					floatingFooter.style.width = "100%";
				}
				});
			}, { threshold: 0 });

			observer.observe(realFooter);
			});

			async function checkAuth() {
				const res = await fetch('/auth/check');
				const data = await res.json().catch(e => { console.error('auth json parse', e); return {}; });
				return Boolean(data.authenticated);
			}

			function createReplyBlock(text) {
				const div = document.createElement('div');
				div.style.whiteSpace = 'pre-wrap';

				const divider = document.createElement('span');
				divider.classList.add('replied');
				
				div.prepend(divider);
				if (text) div.appendChild(document.createTextNode(text));
				return div;
			}

			// strips leading spaces/tabs from each line, preserves \n, returns '' for null/undefined
			const stripLeftEachLine = s => {
				if (s == null) return '';
				return String(s).replace(/\r\n/g, '\n').replace(/^[ \t]+/gm, '');
			};

			// small helper to check non-empty string
			const hasText = v => v != null && String(v).trim() !== '';

			// safer version of renderPosts with debugging & guards
			async function renderPosts() {
				try {
					const res = await fetch('/posts/fetch');
					if (!res.ok) {
						console.error('fetch /posts/fetch failed', res.status, res.statusText);
						return;
					}

					const data = await res.json().catch(e => { console.error('parse posts json', e); return null; });
					console.log('raw fetched data:', data);

					if (!Array.isArray(data)) {
						console.error('expected array from /posts/fetch, got:', data);
						return;
					}

					const ul = document.querySelector('.dts ul');
					ul.innerHTML = '';


					data.forEach((post, idx) => {
						try {
							const li = document.createElement('li');
								li.style.whiteSpace = 'pre-wrap';

								const before = post && post.content_before ? post.content_before : null;
								const after  = post && post.content_after  ? post.content_after  : null;
								const image  = post && post.image && String(post.image).trim() !== '' ? String(post.image) : null;

								const beforeText = before && before.text != null ? stripLeftEachLine(before.text) : '';
								const afterText  = after  && after.text  != null ? stripLeftEachLine(after.text)  : '';

								const beforeExists = !!before;
								const afterExists  = !!after;
								const hasBeforeText = hasText(beforeText);
								const hasAfterText  = hasText(afterText);
								const hasImage = !!image;

								const beforeIsReply = beforeExists && Boolean(before.is_reply);
								const afterIsReply  = afterExists  && Boolean(after.is_reply);

								if (beforeIsReply || afterIsReply) li.classList.add('reply');

								// render before
								if (beforeExists) {
									if (beforeIsReply) {
										li.appendChild(createReplyBlock(beforeText));
									} else if (hasBeforeText) {
										li.appendChild(document.createTextNode(beforeText));
									}
								}

								// render image
								if (hasImage) {
									const img = document.createElement('img');
									img.src = image;
									li.appendChild(img);
								}

								// render after
								if (afterExists) {
									if (afterIsReply) {
										li.appendChild(createReplyBlock(afterText));
									} else if (hasAfterText) {
										const needNewline = li.childNodes.length > 0;
										if (needNewline) li.appendChild(document.createTextNode('\n' + afterText));
										else li.appendChild(document.createTextNode(afterText));
									}
								}

								ul.appendChild(li);
						} catch (innerErr) {
							console.error('error rendering post at index', idx, innerErr);
						}
					});

				} catch (err) {
					console.error('renderPosts failed', err);
				}
			}

			// admin / auth bits unchanged
			let isAuthenticated = false;

			async function refreshAuth() {
				isAuthenticated = await checkAuth();

				let dash = document.querySelector(".dash");
				if (isAuthenticated) dash.href = "/dashboard";
				else dash.href = "/auth/discord";
			}

			async function init() {
				await refreshAuth();
				renderPosts();
			}

			init();
		</script>
	</body>
</html>